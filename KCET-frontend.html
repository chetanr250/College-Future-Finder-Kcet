<!DOCTYPE html>
<html lang="en">
<head>
  <style>
      body { 
 background-image: url("https://psmag.com/.image/t_share/MTUwMjg0NDIxMTE3NzgyMDEy/college-2.jpg");
        background-repeat: no-repeat;
        background-size: 100% 100%;
        /* background: rgb(255,0,0); */
/* background: rgb(255,220,0);
background:  linear-gradient(48deg, rgba(255,220,0,1) 0%, rgba(255,0,0,1) 100%); */
/* background: rgb(0,149,255);
background: -moz-linear-gradient(48deg, rgba(0,149,255,1) 0%, rgba(0,0,0,1) 100%);
background: -webkit-linear-gradient(48deg, rgba(0,149,255,1) 0%, rgba(0,0,0,1) 100%);
background: linear-gradient(48deg, rgba(0,149,255,1) 0%, rgba(0,0,0,1) 100%);
filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#0095ff",endColorstr="#000000",GradientType=1); */
        box-shadow: rgb(204, 219, 232) 3px 3px 6px 0px inset, rgba(255, 255, 255, 0.5) -3px -3px 6px 1px inset;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
      }
      .container {
        /* width: 100px; */
        padding: 20px;
        background-color: #ffffffc5;
        box-shadow: 0 40px 60px rgba(1, 1, 1, 1);
        border-radius: 10px;
        text-align: center;;
      }
      span{
        text-decoration: blue;
      }
      #warning{
        text-align: left;
        padding: 5px ;
      }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body style=""> 
    <div class="container">
      <h4 style="color: black; font-family: 'American Typewriter';">Future Finder - KCET</h4>
      <span id="device">
    <div class="row">
      <div class="input-field col s4">
        <input id="rank" type="number" class="validate" >
        <label for="rank" style="color: black; font-family: 'American Typewriter';">Rank</label>
      </div>
    <div class="input-field col s4">
      <input id="email" type="email" class="validate">
      <label for="email" style="color: black; font-family: 'American Typewriter';" >E-Mail</label>
    </div>
    <div class="input-field col s4">
      <input type="text" id="branch" class="autocomplete">
      <label for="branch" style="color: black; font-family: 'American Typewriter';">Branch</label>
    </div> 
  </div>
  <div class="row">
    <div class="input-field col s12 ">
      <textarea id="address" class="materialize-textarea " data-length="500"></textarea>
      <label for="address"  style="color: black; font-family: 'American Typewriter';">Address</label>
    </div> </div>
      </span>
      <p id='warning'  style="color: red; font-family: 'American Typewriter';"></p>
      <table id="fullTable" class="striped">
        <thead >
          <tr id="tableHead">
          </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
      </table>
   
  <button class="waves-effect waves-light btn blue" id="submit">Submit</button> 
</div> 
 </div>
</div>
</body>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

  <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
  $(document).ready(function() {
      M.updateTextFields();
    });

    branchData = ["AD Artificial intelligence, Data Science", "AE Aeronautical Engineering", "AI Artificial intelligence", "AU Automobile", "BT Bio Technology", "CA CS (AI, Machine Learning)", "CB Computer Science and Business Systems", "CD Computer Science and Design", "CE Civil", "CF CS(Artificial intelligence.)", "CH Chemical", "CS Computers", "CY CS- Cyber Security", "DS Computer Science Engg- Data Science", "EC Electronics", "EE Electrical", "EI Electrical and Instrumentation Engg", "ES Electronics and Computer", "ET Electrical and Telecommunication Engg.", "IC CS-IoT, Cyber Security", "IS Information Science", "MD Medical Electronics", "ME Mechanical", "RI Robotics and AI", "RA Robotics and Automation", "SE Aero Space Engg."]

    $(document).ready(function(){
    $('input.autocomplete').autocomplete({
      data: {
   "AD Artificial intelligence, Data Science" :null, "AE Aeronautical Engineering" :null, "AI Artificial intelligence" :null, "AU Automobile" :null, "BT Bio Technology" :null, "CA CS (AI, Machine Learning)" :null, "CB Computer Science and Business Systems" :null, "CD Computer Science and Design" :null, "CE Civil" :null, "CF CS(Artificial intelligence.)" :null, "CH Chemical" :null, "CS Computers" :null, "CY CS- Cyber Security" :null, "DS Computer Science Engg- Data Science" :null, "EC Electronics" :null, "EE Electrical" :null, "EI Electrical and Instrumentation Engg" :null, "ES Electronics and Computer" :null, "ET Electrical and Telecommunication Engg." :null, "IC CS-IoT, Cyber Security" :null, "IS Information Science" :null, "MD Medical Electronics" :null, "ME Mechanical" :null, "RI Robotics and AI" :null, "RA Robotics and Automation" :null, "SE Aero Space Engg." :null, 
      },
    });
  });
  </script>  
<script>


var mobileViewHtml = `<div class="row">
        <div class="input-field col s12">
          <input id="rank" type="number" class="validate" >
          <label for="rank" style="color: black; font-family: 'American Typewriter';  font-size: larger;">Rank</label>
        </div>
      </div>
        <div class="row">
      <div class="input-field col s12">
        <input id="email" type="email" class="validate">
        <label for="email" style="color: black; font-family: 'American Typewriter';  font-size: larger;" >E-Mail</label>
      </div>
    </div>
    <div class="row">
      <div class="input-field col s12">
        <input type="text" id="branch" class="autocomplete">
        <label for="branch" style="color: black; font-family: 'American Typewriter';  font-size: larger;">Branch</label>
      </div> 
    </div>
    <div class="row">
      <div class="input-field col s12 ">
        <textarea id="address" class="materialize-textarea " data-length="500"></textarea>
        <label for="address"  style="color: black; font-family: 'American Typewriter';  font-size: larger;">Address</label>
      </div>  
    </div>`;

  function start(){
    let details = navigator.userAgent;
    let regexp = /android|iphone|kindle|ipad/i;
    let isMobileDevice = regexp.test(details);

  if (!isMobileDevice) {
    console.log('You are using destop');

  } else {
  document.getElementById('device').innerHTML = mobileViewHtml;
  document.getElementbyTagName('body').style = 'background: linear-gradient(312deg, rgba(0,0,0,1) 0%, rgba(0,161,255,1) 100%); ';
  console.log('mobile'); 
  }
  }
  start();
</script>
  <script>
    function pressed(){
      var txt = document.getElementById("input").value;
      var arr;
    arr = google.script.run.withSuccessHandler(receiveDataFromServer).myFunction(txt);
}

function receiveDataFromServer(data){
  console.log(data);
  alert(data);
}
var rank = document.getElementById("rank");
var email = document.getElementById("email");
var branch = document.getElementById("branch");
var address = document.getElementById("address");
var submit = document.getElementById("submit");
var tableBody = document.getElementById("tableBody");
var tableHead = document.getElementById("tableHead");
var p = document.getElementById('warning');

rank.addEventListener("keypress",function(e){
  if(e.key == "Enter"){
    email.focus();
  }
});
email.addEventListener("keypress",function(e){
  if(e.key == "Enter"){
    branch.focus();
  }
});
branch.addEventListener("keypress",function(e){
  if(e.key == "Enter"){
    address.focus();
  }
});
submit.addEventListener("click",function(e){


  if(email.value == '' || rank.value == '' || address.value == '' || branchData.indexOf(branch.value) == -1 || rank.value < 1){
  submit.innerText = "ERROR!";
  p.innerText = "Please enter values in all the above fields.\nAlso make sure you have selected branch from autocomplete dropdown"
  submit.className = submit.className.replace("blue","red");
  setTimeout(function(){
  submit.innerText = "Submit";
  submit.className = submit.className.replace("red","blue");},3000);
    // alert("Please fill all the details!")
  }
  else{
    submit.innerText = "Processing...";
  submit.className = submit.className.replace("blue","red");
  obj = {rank:rank.value,email:email.value,branch:branch.value,address:address.value};
  google.script.run.withSuccessHandler(output).lastPage(obj);

  }
});
function constructTable(data){
  var th = ` <th>Code</th>
              <th>College Name</th>
              <th>Cutoff Rank</th>
              <th>Duration</th>
              <th>Distance</th>`;
  tableHead.innerHTML = th;
  var tableRowHtml = '';
    for(var a = 0; a<data.length; a++){
      tableRowHtml +=
   `        <tr>   
            <td>${data[a][0]}</td>
            <td>${data[a][1]}</td>
            <td>${data[a][2]}</td>
            <td>${data[a][3]}</td>
            <td>${data[a][4]}</td>
            </tr>
    `
    }
    tableBody.innerHTML = tableRowHtml;
    google.script.run.sendMailTo(`<!DOCTYPE html>
<html lang="en">
<body>
${document.getElementById("fullTable").outerHTML}`,email.value,data,branch.value);
}

function output(clgData){
  try{
  if(clgData[0][0].length!=1){
    var totalClgData = [];
    document.getElementById("warning").innerText = "";
    for(var a = 0; a<clgData.length; a++){
      var code = clgData[a][0];
      var clgName = clgData[a][1];
      var cutoff = clgData[a][2];
      var duration = clgData[a][3];
      var distance = clgData[a][4];
      var currentClgData = [code,clgName,cutoff,duration,distance];
      console.log(currentClgData);
      // document.getElementById("warning").innerText += currentClgData + "\n";  
      totalClgData.push(currentClgData);
    }
    constructTable(totalClgData);
    submit.innerText = "Submit";
    submit.className = submit.className.replace("red","blue")
    
    return 0;
  }}
  catch(error){
    console.log(error);
  }
  moreThanRank(clgData[0],clgData[1]);
}

function moreThanRank(lastRank, branch){
  tableBody.innerHTML = '';
  tableHead.innerHTML = '';
  document.getElementById("warning").innerText = "Minimum rank required for "+ branch+ " is " + lastRank;
  submit.innerText = "Submit";
  submit.className = submit.className.replace("red","blue");
}
  </script>
</html>
